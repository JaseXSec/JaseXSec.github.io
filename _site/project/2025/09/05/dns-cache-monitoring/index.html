<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Monitoring DNS Cache with VirusTotal – Windows VM Threat Watch | Jase Jourdain - Cybersecurity Portfolio</title>
    <meta name="description" content="A lightweight monitoring tool that periodically scans a Windows workstation&#39;s DNS cache, extracts domains/IPs, checks them against VirusTotal, and alerts/log...">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/main.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SEO -->
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Monitoring DNS Cache with VirusTotal – Windows VM Threat Watch | Jase Jourdain - Cybersecurity Portfolio</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Monitoring DNS Cache with VirusTotal – Windows VM Threat Watch" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A lightweight monitoring tool that periodically scans a Windows workstation’s DNS cache, extracts domains/IPs, checks them against VirusTotal, and alerts/logs on suspicious findings." />
<meta property="og:description" content="A lightweight monitoring tool that periodically scans a Windows workstation’s DNS cache, extracts domains/IPs, checks them against VirusTotal, and alerts/logs on suspicious findings." />
<link rel="canonical" href="http://localhost:4000/project/2025/09/05/dns-cache-monitoring/" />
<meta property="og:url" content="http://localhost:4000/project/2025/09/05/dns-cache-monitoring/" />
<meta property="og:site_name" content="Jase Jourdain - Cybersecurity Portfolio" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-05T19:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Monitoring DNS Cache with VirusTotal – Windows VM Threat Watch" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-05T19:00:00-05:00","datePublished":"2025-09-05T19:00:00-05:00","description":"A lightweight monitoring tool that periodically scans a Windows workstation’s DNS cache, extracts domains/IPs, checks them against VirusTotal, and alerts/logs on suspicious findings.","headline":"Monitoring DNS Cache with VirusTotal – Windows VM Threat Watch","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/project/2025/09/05/dns-cache-monitoring/"},"url":"http://localhost:4000/project/2025/09/05/dns-cache-monitoring/"}</script>
<!-- End Jekyll SEO tag -->

    
    <!-- Feed -->
    <link rel="alternate" type="application/rss+xml" title="Jase Jourdain - Cybersecurity Portfolio" href="/feed.xml">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <nav class="nav">
                <a href="/" class="nav-brand">Jase Jourdain - Cybersecurity Portfolio</a>
                <ul class="nav-menu">
                    
                    <li><a href="/">Home</a></li>
                    
                    <li><a href="/about">About Me</a></li>
                    <li><a href="/certifications">Certifications & Education</a></li>
                    <li><a href="/projects-blogs">Projects & Blogs</a></li>
                    <li><a href="https://www.linkedin.com/in/jase-jourdain-2353b6256/" class="linkedin">LinkedIn</a></li>
                </ul>
                <button class="nav-toggle" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <article class="post">
    <header class="post-header">
        <div class="container">
            <h1 class="post-title">Monitoring DNS Cache with VirusTotal – Windows VM Threat Watch</h1>
            <div class="post-meta">
                
                <time datetime="2025-09-05T19:00:00-05:00">September 05, 2025</time>
                
                
                <span class="post-category">project</span>
                
                
            </div>
        </div>
    </header>

    <div class="post-content">
        <div class="container">
            <p>A lightweight monitoring tool that periodically scans a Windows workstation’s DNS cache, extracts domains/IPs, checks them against VirusTotal, and alerts/logs on suspicious findings. I built it to add a simple, host-level tripwire for malware/phishing activity in home-lab and small-biz environments.</p>

<h2 id="key-features">Key Features</h2>

<ol>
  <li><strong>DNS Cache Collection</strong>: Periodically collects DNS cache entries using the <code class="language-plaintext highlighter-rouge">ipconfig /displaydns</code> command on a Windows workstation.</li>
  <li><strong>Malicious IP/Domain Detection</strong>: Integrates with the VirusTotal API to check cached IPs and domains against a vast database of known malicious entities.</li>
  <li><strong>Automated Alerts</strong>: Sends real-time alerts via email (or other notification systems) when a malicious entry is detected.</li>
  <li><strong>Logging and Reporting</strong>: Maintains a log file for all DNS cache scans, including details of detected threats, for future analysis and auditing.</li>
  <li><strong>Task Automation</strong>: Uses Windows Task Scheduler to run the monitoring script at regular intervals, ensuring continuous protection.</li>
</ol>

<h2 id="technologies-used">Technologies Used</h2>

<ul>
  <li><strong>Python</strong>: For automating DNS cache extraction, API integration, and alert generation.</li>
  <li><strong>VirusTotal API</strong>: To verify IP addresses and domains against a database of known malicious entities.</li>
  <li><strong>Windows Task Scheduler</strong>: To automate periodic script execution.</li>
  <li><strong>Proxmox</strong>: Hosting the Windows VM for running the monitoring system.</li>
</ul>

<h2 id="project-workflow">Project Workflow</h2>

<ol>
  <li><strong>Data Collection</strong>: The script runs the <code class="language-plaintext highlighter-rouge">ipconfig /displaydns</code> command to extract DNS cache entries from the Windows system.</li>
  <li><strong>Data Parsing</strong>: Parses the output to extract relevant IP addresses and domain names.</li>
  <li><strong>Threat Analysis</strong>: Queries each IP/domain through the VirusTotal API to check for malicious activity.</li>
  <li><strong>Alert Mechanism</strong>: If a malicious entity is detected, an alert is triggered via email or logged for review.</li>
  <li><strong>Continuous Monitoring</strong>: Automates the process with Task Scheduler to ensure regular scans.</li>
</ol>

<h2 id="use-cases">Use Cases</h2>

<ul>
  <li><strong>Network Security</strong>: Helps identify potential cyber threats at the DNS level within a local network.</li>
  <li><strong>Cybersecurity Research</strong>: Assists researchers in monitoring and analyzing DNS activity.</li>
  <li><strong>Personal or Small Business Protection</strong>: Provides an additional layer of defense for individuals or small organizations against cyber threats.</li>
</ul>

<p>This project demonstrates practical skills in cybersecurity, Python scripting, API integration, and automation. It can be expanded with additional features such as Slack/Telegram notifications, data visualization dashboards, or integration with SIEM systems for enterprise-level monitoring.</p>

<h2 id="lets-dig-in-shall-we">Let’s dig in, shall we?</h2>

<p>Our first step in this project is creating a windows VM that will act as our DNS catcher. This can be done in many ways, but for my case we will be using a VM within my Proxmox cluster I have set up on my local network. Feel free to use any hypervisor you have available to you.</p>

<p><img src="/assets/images/dns-cache-monitoring/Pasted%20image%2020250208133932.png" alt="VM Resource Allocation" />
<em>Figure 1: VM resource allocation showing minimal requirements</em></p>

<p>As you can see, this VM does not have to be heavily resourced.</p>

<p>Next, let get python installed on our VM,</p>

<p><img src="/assets/images/dns-cache-monitoring/Pasted%20image%2020250208135950.png" alt="Python Installation" />
<em>Figure 2: Installing Python on the Windows VM</em></p>

<p>Once python is installed, let get any required dependencies installed as well. In this project, we need to install the requests dependency. this can be done with <code class="language-plaintext highlighter-rouge">pip install requests</code></p>

<p><img src="/assets/images/dns-cache-monitoring/Pasted%20image%2020250208140650.png" alt="Installing Dependencies" />
<em>Figure 3: Installing the requests dependency</em></p>

<p>Next we need to create a script in python for extracting DNS cache using <code class="language-plaintext highlighter-rouge">ipconfig /displaydns</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">subprocess</span>

<span class="k">def</span> <span class="nf">get_dns_cache</span><span class="p">():</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="sh">"</span><span class="s">ipconfig</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/displaydns</span><span class="sh">"</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">stdout</span>

<span class="k">def</span> <span class="nf">parse_dns_cache</span><span class="p">(</span><span class="n">dns_data</span><span class="p">):</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">dns_data</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">Record Name</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">current_entry</span><span class="p">[</span><span class="sh">"</span><span class="s">record_name</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="sh">"</span><span class="s">Record Type</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">current_entry</span><span class="p">[</span><span class="sh">"</span><span class="s">record_type</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="sh">"</span><span class="s">Time To Live</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">current_entry</span><span class="p">[</span><span class="sh">"</span><span class="s">ttl</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="sh">"</span><span class="s">Data</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">current_entry</span><span class="p">[</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_entry</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">record_name</span><span class="sh">"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">current_entry</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">entries</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">current_entry</span><span class="p">)</span>
            <span class="n">current_entry</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">return</span> <span class="n">entries</span>

<span class="c1"># Test the DNS cache extraction
</span><span class="n">dns_data</span> <span class="o">=</span> <span class="nf">get_dns_cache</span><span class="p">()</span>
<span class="n">dns_entries</span> <span class="o">=</span> <span class="nf">parse_dns_cache</span><span class="p">(</span><span class="n">dns_data</span><span class="p">)</span>

<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dns_entries</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</code></pre></div></div>

<p>What does this code do?</p>
<ul>
  <li>Fetches cache using the <code class="language-plaintext highlighter-rouge">ipconfig /displaydns</code> command</li>
  <li>Parses the data to extract IP addresses or domains for analysis</li>
</ul>

<p>Next we want to create a script for the VirusTotal API integration:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>

<span class="n">VIRUSTOTAL_API_KEY</span> <span class="o">=</span> <span class="sh">"</span><span class="s">your_virustotal_api_key</span><span class="sh">"</span>
<span class="n">VIRUSTOTAL_BASE_URL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://www.virustotal.com/api/v3</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">check_ip_virustotal</span><span class="p">(</span><span class="n">ip_address</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">VIRUSTOTAL_BASE_URL</span><span class="si">}</span><span class="s">/ip_addresses/</span><span class="si">{</span><span class="n">ip_address</span><span class="si">}</span><span class="sh">"</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">x-apikey</span><span class="sh">"</span><span class="p">:</span> <span class="n">VIRUSTOTAL_API_KEY</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="c1"># Test the VirusTotal API with an example IP
</span><span class="n">result</span> <span class="o">=</span> <span class="nf">check_ip_virustotal</span><span class="p">(</span><span class="sh">"</span><span class="s">8.8.8.8</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Replace with a real IP from your DNS cache
</span><span class="k">if</span> <span class="n">result</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

        </div>
    </div>

    <footer class="post-footer">
        <div class="container">
            <div class="post-tags">
                
                <h4>Tags:</h4>
                <div class="tags">
                    
                    <span class="tag">cybersecurity</span>
                    
                    <span class="tag">research</span>
                    
                    <span class="tag">tutorial</span>
                    
                    <span class="tag">analysis</span>
                    
                    <span class="tag">malware</span>
                    
                    <span class="tag">forensics</span>
                    
                    <span class="tag">network-security</span>
                    
                    <span class="tag">incident-response</span>
                    
                </div>
                
            </div>
            
            <div class="post-navigation">
                <a href="/projects-blogs" class="back-button">
                    <span>← Back to Write-ups and Blogs</span>
                </a>
            </div>
        </div>
    </footer>
</article>

    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p>Email: <a href="mailto:contact@jasejourdain.com" class="email-link">contact@jasejourdain.com</a></p>
                    <p>Want a copy of my résumé? Feel free to email me directly.</p>
                </div>
                <div class="footer-section">
                    <p>&copy; 2025 Jase Jourdain - Cybersecurity Portfolio. All rights reserved.</p>
                    <div class="social-links">
                        <a href="https://github.com/JaseXSec" target="_blank" rel="noopener">GitHub</a>
                        <a href="https://www.linkedin.com/in/jase-jourdain-2353b6256/" target="_blank" rel="noopener">LinkedIn</a>
                        <a href="https://x.com/JaseCyberSec" target="_blank" rel="noopener">X</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="/assets/js/main.js"></script>
</body>
</html>
